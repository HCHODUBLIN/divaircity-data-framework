version: 2

models:
  # =============================================
  # GEOSPATIAL BOUNDARIES
  # =============================================
  - name: stg_country
    description: "Cleaned country reference data from EU registries"
    columns:
      - name: country_id
        description: "Primary key"
        tests:
          - unique
          - not_null

  - name: stg_admin_div_1
    description: "City-level geographic boundary (e.g., London, Potsdam, Orvieto)"
    columns:
      - name: admin_div_1_id
        description: "Primary key"
        tests:
          - unique
          - not_null
      - name: country_id
        tests:
          - not_null
          - relationships:
              to: ref('stg_country')
              field: country_id

  - name: stg_admin_div_2
    description: "Borough-level geographic boundary (e.g., Lambeth, Scalo)"
    columns:
      - name: admin_div_2_id
        description: "Primary key"
        tests:
          - unique
          - not_null
      - name: admin_div_1_id
        tests:
          - not_null
          - relationships:
              to: ref('stg_admin_div_1')
              field: admin_div_1_id

  - name: stg_admin_div_3
    description: "Neighbourhood-level boundary (ward level) - finest granularity for disadvantaged area analysis"
    columns:
      - name: admin_div_3_id
        description: "Primary key"
        tests:
          - unique
          - not_null
      - name: admin_div_2_id
        tests:
          - not_null
          - relationships:
              to: ref('stg_admin_div_2')
              field: admin_div_2_id

  - name: stg_location
    description: "Physical location (address of building, sensor placement, NBS site)"
    columns:
      - name: location_id
        description: "Primary key"
        tests:
          - unique
          - not_null

  # =============================================
  # AGENTS
  # =============================================
  - name: stg_community
    description: "Community groups with 6+1 diversity classifications. GDPR: Diversity at aggregate level only."
    columns:
      - name: community_id
        description: "Primary key"
        tests:
          - unique
          - not_null
      - name: community_type
        tests:
          - accepted_values:
              values: ['place', 'demographic', 'interest', 'circumstances']

  - name: stg_organisation
    description: "Partner organisations and local authorities"
    columns:
      - name: organisation_id
        description: "Primary key"
        tests:
          - unique
          - not_null
      - name: organisation_type
        tests:
          - accepted_values:
              values: ['private', 'community group', 'research', 'public']

  - name: stg_person
    description: "Anonymised participant records. GDPR: No PII - only surrogate key and membership links."
    columns:
      - name: person_id
        description: "Surrogate key - no PII"
        tests:
          - unique
          - not_null

  # =============================================
  # CO-CREATION GOVERNANCE
  # =============================================
  - name: stg_plan
    description: "Urban action plans from city partners"
    columns:
      - name: plan_id
        tests:
          - unique
          - not_null
      - name: scope
        tests:
          - accepted_values:
              values: ['national', 'regional', 'city', 'neighbourhood']

  - name: stg_objective
    description: "Plan objectives"
    columns:
      - name: objective_id
        tests:
          - unique
          - not_null

  - name: stg_phase
    description: "Co-creation phases within plans"
    columns:
      - name: phase_id
        tests:
          - unique
          - not_null

  - name: stg_engagement_tool
    description: "Tools used to collect citizen data (surveys, apps, sensors)"
    columns:
      - name: tool_id
        tests:
          - unique
          - not_null
      - name: tool_type
        tests:
          - accepted_values:
              values: ['survey', 'workshop', 'app', 'sensor']

  - name: stg_event
    description: "Co-creation events (workshops, meetings, educational)"
    columns:
      - name: event_id
        tests:
          - unique
          - not_null
      - name: event_type
        tests:
          - accepted_values:
              values: ['education', 'consultation', 'workshop', 'meeting']

  - name: stg_decision
    description: "Decisions made at events"
    columns:
      - name: decision_id
        tests:
          - unique
          - not_null

  # =============================================
  # CITY OBJECTS
  # =============================================
  - name: stg_nbs_project
    description: "Nature-Based Solution implementations with cost-benefit metrics"
    columns:
      - name: nbs_id
        tests:
          - unique
          - not_null
      - name: nbs_type
        tests:
          - accepted_values:
              values: ['green wall', 'green roof', 'bioswale', 'urban forest', 'rain garden', 'permeable pavement']

  - name: stg_sensor
    description: "Environmental sensors deployed across cities"
    columns:
      - name: sensor_id
        tests:
          - unique
          - not_null

  - name: stg_building
    description: "Buildings for NBS proximity analysis"
    columns:
      - name: building_id
        tests:
          - unique
          - not_null

  - name: stg_campaign
    description: "Policy campaigns and interventions (e.g., low emission zones)"
    columns:
      - name: campaign_id
        tests:
          - unique
          - not_null

  # =============================================
  # ECONOMIC & METRICS
  # =============================================
  - name: stg_metric
    description: "Metric definitions (KPIs, indicators)"
    columns:
      - name: metric_id
        tests:
          - unique
          - not_null
      - name: metric_type
        tests:
          - accepted_values:
              values: ['social', 'environmental', 'economic']

  - name: stg_resource
    description: "Financial resources allocated to plans"
    columns:
      - name: resource_id
        tests:
          - unique
          - not_null

  # =============================================
  # SOCIAL METRICS & SURVEYS
  # =============================================
  - name: stg_public_statistics
    description: "Demographics, economics, and health statistics at neighbourhood level. GDPR: Aggregated data only."
    columns:
      - name: stat_id
        tests:
          - unique
          - not_null

  - name: stg_survey
    description: "Survey metadata"
    columns:
      - name: survey_id
        tests:
          - unique
          - not_null

  - name: stg_citizen_response
    description: "Citizen-generated data from engagement tools"
    columns:
      - name: response_id
        tests:
          - unique
          - not_null

  - name: stg_panas_score
    description: "PANAS mood assessment scores linked to walking routes"
    columns:
      - name: panas_id
        tests:
          - unique
          - not_null
      - name: status
        tests:
          - accepted_values:
              values: ['before', 'after']

  # =============================================
  # FACT TABLES (STAGING)
  # =============================================
  - name: stg_sensor_measurement
    description: "Time-series sensor readings with route tracking - primary fact source"
    columns:
      - name: measurement_id
        tests:
          - unique
          - not_null
      - name: sensor_id
        tests:
          - not_null
      - name: value
        tests:
          - not_null

  - name: stg_event_participation
    description: "Event participation records - used for 6+1 diversity analysis"
    columns:
      - name: participation_id
        tests:
          - unique
          - not_null
      - name: event_id
        tests:
          - not_null
      - name: person_id
        tests:
          - not_null

  - name: stg_survey_response
    description: "Survey response analysis with sentiment scoring"
    columns:
      - name: response_id
        tests:
          - unique
          - not_null
      - name: sentiment_score
        description: "Sentiment score from -1.0 (negative) to 1.0 (positive)"
